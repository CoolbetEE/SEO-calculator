<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SEO Revenue Calculator</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'San Francisco', 'Helvetica Neue', Arial, sans-serif;
      background: url('https://i.imgur.com/4e8YmHp.png') repeat;
      color: #ffffff;
      line-height: 1.5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 10px;
      position: relative;
    }

    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: inherit;
      filter: blur(2px);
      z-index: -1;
    }

    .container {
      max-width: 1000px;
      width: 100%;
      background: rgba(20, 20, 25, 0.9);
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      padding: 20px;
      margin: 10px auto;
      overflow: hidden;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header img {
      max-width: 120px;
      margin-bottom: 12px;
    }

    h1 {
      font-size: 26px;
      font-weight: 600;
      background: linear-gradient(90deg, #5b86e5, #36d1dc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 4px;
    }

    .subtitle {
      font-size: 14px;
      color: #b0b0b5;
      font-weight: 400;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    .highlight-name {
      background: linear-gradient(90deg, #5b86e5, #36d1dc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 600;
    }

    .content {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .input-box {
      background: rgba(30, 30, 35, 0.9);
      padding: 16px;
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .output-box {
      background: rgba(25, 25, 30, 0.95);
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    .summary-box {
      background: rgba(40, 40, 45, 0.9);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      text-align: center;
      font-size: 14px;
      color: #b0b0b5;
    }

    .summary-box h3 {
      font-size: 16px;
      margin-bottom: 8px;
      background: linear-gradient(90deg, #5b86e5, #36d1dc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .tabs {
      display: flex;
      gap: 16px;
      margin-bottom: 16px;
      border-bottom: 1px solid #404045;
    }

    .tab {
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      color: #b0b0b5;
      transition: color 0.3s;
    }

    .tab.active {
      color: #ffffff;
      border-bottom: 2px solid #5b86e5;
    }

    .tab:hover {
      color: #ffffff;
    }

    label {
      font-size: 14px;
      font-weight: 600;
      color: #ffffff;
      margin-bottom: 4px;
    }

    input, select, button {
      width: 100%;
      padding: 12px;
      border: 1px solid #404045;
      border-radius: 8px;
      font-size: 16px;
      background: #25252a;
      color: #ffffff;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input::placeholder, select::placeholder {
      color: #8e8e93;
      opacity: 1;
    }

    input:focus, select:focus, button:focus {
      outline: none;
      border-color: #5b86e5;
      box-shadow: 0 0 0 3px rgba(91, 134, 229, 0.2);
    }

    button {
      background: linear-gradient(90deg, #5b86e5, #36d1dc);
      color: #ffffff;
      font-weight: 500;
      border: none;
      cursor: pointer;
      transition: opacity 0.3s;
      padding: 14px;
      margin-top: 8px;
    }

    button:hover {
      opacity: 0.9;
    }

    .export-buttons {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .export-buttons button {
      background: #404045;
      color: #ffffff;
      flex: 1;
      padding: 12px;
    }

    .export-buttons button:hover {
      background: #505055;
    }

    .result {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(30, 30, 35, 0.9);
      font-size: 14px;
      line-height: 1.6;
    }

    .result p {
      margin-bottom: 12px;
    }

    .blue-text {
      color: #5b86e5;
      font-weight: 600;
    }

    #spinner {
      display: none;
      text-align: center;
      font-size: 16px;
      color: #b0b0b5;
      margin: 12px 0;
    }

    #revenueChart {
      margin-top: 16px;
      background: rgba(25, 25, 30, 0.95);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    }

    #monthlyOutput, #quarterlyOutput, #revenueChart {
      display: none;
    }

    .flag {
      width: 20px;
      height: 14px;
      vertical-align: middle;
      margin-left: 8px;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 48px;
      height: 28px;
      margin-left: 12px;
      vertical-align: middle;
    }

    .toggle-switch input {
      display: none;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #404045;
      transition: 0.3s;
      border-radius: 28px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 24px;
      width: 24px;
      left: 2px;
      bottom: 2px;
      background-color: #ffffff;
      transition: 0.3s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: #5b86e5;
    }

    input:checked + .slider:before {
      transform: translateX(20px);
    }

    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }

      h1 {
        font-size: 22px;
      }

      .subtitle {
        font-size: 12px;
      }

      input, select, button {
        font-size: 14px;
        padding: 10px;
      }

      label {
        font-size: 12px;
      }
    }

    @media (max-width: 400px) {
      .container {
        padding: 12px;
        margin: 5px;
      }

      .header img {
        max-width: 100px;
      }

      h1 {
        font-size: 20px;
      }

      input, select, button {
        font-size: 12px;
        padding: 8px;
      }

      label {
        font-size: 10px;
      }

      .export-buttons {
        flex-direction: column;
      }

      .export-buttons button {
        padding: 10px;
      }
    }

    /* Light Mode */
    body.light-mode {
      color: #1d1d1f;
    }

    body.light-mode::before {
      filter: blur(2px);
    }

    body.light-mode .container {
      background: rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    body.light-mode .input-box {
      background: rgba(245, 245, 247, 0.9);
    }

    body.light-mode .output-box {
      background: rgba(255, 255, 255, 0.95);
    }

    body.light-mode .summary-box {
      background: rgba(245, 245, 247, 0.9);
      color: #1d1d1f;
    }

    body.light-mode input,
    body.light-mode select,
    body.light-mode button {
      background: #ffffff;
      color: #1d1d1f;
      border-color: #d2d2d7;
    }

    body.light-mode input::placeholder,
    body.light-mode select::placeholder {
      color: #8e8e93;
    }

    body.light-mode label {
      color: #1d1d1f;
    }

    body.light-mode .result {
      background: rgba(245, 245, 247, 0.9);
      color: #1d1d1f;
    }

    body.light-mode #revenueChart {
      background: rgba(255, 255, 255, 0.95);
    }

    body.light-mode .subtitle {
      color: #6e6e73;
    }

    body.light-mode button {
      background: linear-gradient(90deg, #5b86e5, #36d1dc);
    }

    body.light-mode .export-buttons button {
      background: #e8e8ed;
      color: #1d1d1f;
    }

    body.light-mode .export-buttons button:hover {
      background: #d2d2d7;
    }

    body.light-mode .slider {
      background-color: #d2d2d7;
    }

    body.light-mode input:checked + .slider {
      background-color: #5b86e5;
    }

    body.light-mode .tab {
      color: #6e6e73;
    }

    body.light-mode .tab.active {
      color: #1d1d1f;
      border-bottom: 2px solid #5b86e5;
    }

    body.light-mode .tab:hover {
      color: #1d1d1f;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body class="dark-mode">
  <div class="container">
    <div class="header">
      <img src="https://i.imgur.com/xpnQzsh.png" alt="Logo" onerror="this.src='https://via.placeholder.com/120x60.png?text=No+Logo';">
      <h1>SEO Revenue Calculator</h1>
      <div class="subtitle">
        by <span class="highlight-name">Edvard Kingissepp</span> 
        <label class="toggle-switch">
          <input type="checkbox" onclick="toggleMode()">
          <span class="slider"></span>
        </label>
      </div>
    </div>
    <div class="content">
      <div class="input-box">
        <label for="keyword">Keyword</label>
        <input type="text" id="keyword" placeholder="Enter keyword">

        <label for="volume">Monthly Search Volume</label>
        <input type="number" id="volume" placeholder="Enter search volume">

        <label for="market">Select Market</label>
        <select id="market" onchange="setFlag()">
          <option value="FI">Finland</option>
          <option value="SE">Sweden</option>
          <option value="EE">Estonia</option>
          <option value="CA">Canada</option>
          <option value="CL">Chile</option>
          <option value="EC">Ecuador</option>
          <option value="IS">Iceland</option>
          <option value="MX">Mexico</option>
          <option value="NO">Norway</option>
          <option value="ONT">Ontario</option>
          <option value="PE">Peru</option>
        </select>
        <span id="flagDisplay"></span>

        <label for="valueType">Revenue Type</label>
        <select id="valueType">
          <option value="ngr">NGR</option>
          <option value="turnover">Turnover</option>
        </select>

        <button onclick="calculateRevenue()">Calculate Revenue</button>
        <div id="spinner">⏳ Calculating...</div>
        <div class="export-buttons">
          <button onclick="exportToCSV()">Export CSV</button>
          <button onclick="window.print()">Export PDF</button>
        </div>
      </div>
      <div class="output-box">
        <div class="summary-box" id="summaryOutput"></div>
        <div class="tabs">
          <div class="tab active" onclick="showTab('monthly')">Monthly</div>
          <div class="tab" onclick="showTab('quarterly')">Quarterly</div>
        </div>
        <div id="monthlyOutput" class="result"></div>
        <div id="quarterlyOutput" class="result"></div>
        <canvas id="revenueChart"></canvas>
      </div>
    </div>
  </div>
  <script>
    const flags = {
      FI: "https://flagcdn.com/fi.svg",
      SE: "https://flagcdn.com/se.svg",
      EE: "https://flagcdn.com/ee.svg",
      CA: "https://flagcdn.com/ca.svg",
      CL: "https://flagcdn.com/cl.svg",
      EC: "https://flagcdn.com/ec.svg",
      IS: "https://flagcdn.com/is.svg",
      MX: "https://flagcdn.com/mx.svg",
      NO: "https://flagcdn.com/no.svg",
      ONT: "https://flagcdn.com/ca.svg",
      PE: "https://flagcdn.com/pe.svg"
    };

    const data = {
      FI: { ngr: 62.75, turnover: 1616.56, cr: 0.05 },
      SE: { ngr: 46.27, turnover: 1324.77, cr: 0.05 },
      EE: { ngr: 44.22, turnover: 1267.34, cr: 0.05 },
      CA: { ngr: 35.26, turnover: 2578.08, cr: 0.04 },
      CL: { ngr: 27.54, turnover: 531.64, cr: 0.03 },
      EC: { ngr: 16.62, turnover: 484.91, cr: 0.03 },
      IS: { ngr: 78.94, turnover: 1869.87, cr: 0.05 },
      MX: { ngr: 6.85, turnover: 497.3, cr: 0.03 },
      NO: { ngr: 117.41, turnover: 2757.3, cr: 0.05 },
      ONT: { ngr: -80.48, turnover: 1865.69, cr: 0.04 },
      PE: { ngr: 26.14, turnover: 443.48, cr: 0.03 }
    };

    const visibility = [
      { ctr: 0.30, label: "Position 1" },
      { ctr: 0.15, label: "Position 2" },
      { ctr: 0.10, label: "Position 3" },
      { ctr: 0.07, label: "Position 4" },
      { ctr: 0.05, label: "Position 5" },
      { ctr: 0.03, label: "Positions 6–10" }
    ];

    function setFlag() {
      const market = document.getElementById('market').value;
      document.getElementById('flagDisplay').innerHTML = `<img class="flag" src="${flags[market]}" alt="${market} flag">`;
    }

    function toggleMode() {
      document.body.classList.toggle("light-mode");
      document.body.classList.toggle("dark-mode");
    }

    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`.tab[onclick="showTab('${tab}')"]`).classList.add('active');
      
      const monthlyOutput = document.getElementById('monthlyOutput');
      const quarterlyOutput = document.getElementById('quarterlyOutput');
      
      if (tab === 'monthly') {
        monthlyOutput.style.display = 'block';
        quarterlyOutput.style.display = 'none';
      } else {
        monthlyOutput.style.display = 'none';
        quarterlyOutput.style.display = 'block';
      }
    }

    function calculateRevenue() {
      const volume = parseFloat(document.getElementById('volume').value);
      const market = document.getElementById('market').value;
      const valueType = document.getElementById('valueType').value;

      if (isNaN(volume) || volume <= 0) {
        alert("Please enter a valid search volume.");
        return;
      }

      const { cr, ngr, turnover } = data[market];
      const aov = valueType === 'ngr' ? ngr : turnover;

      const monthlyOutput = document.getElementById("monthlyOutput");
      const quarterlyOutput = document.getElementById("quarterlyOutput");
      const summaryOutput = document.getElementById("summaryOutput");
      const spinner = document.getElementById("spinner");
      spinner.style.display = "block";
      monthlyOutput.innerHTML = "";
      quarterlyOutput.innerHTML = "";
      summaryOutput.innerHTML = "";

      const labels = [];
      const revenues = [];
      let totalTraffic = 0;
      let totalConversions = 0;
      let totalRevenue = 0;

      setTimeout(() => {
        let monthlyHtml = "";
        let quarterlyHtml = "";

        visibility.forEach(({ ctr, label }, index) => {
          const monthlyTraffic = Math.round(volume * ctr); // Original monthly calculation
          const monthlyConv = Math.round(monthlyTraffic * cr);
          const monthlyRev = Math.round(monthlyConv * aov);

          const quarterlyTraffic = monthlyTraffic * 3; // Quarterly = Monthly * 3
          const quarterlyConv = monthlyConv * 3;
          const quarterlyRev = monthlyRev * 3;

          totalTraffic += monthlyTraffic;
          totalConversions += monthlyConv;
          totalRevenue += monthlyRev;

          labels.push(label);
          revenues.push(monthlyRev);

          monthlyHtml += `
            <p>
              <strong>${(ctr * 100).toFixed(1)}% CTR - ${label}</strong><br>
              Traffic: <span class="blue-text">${monthlyTraffic.toLocaleString()}</span><br>
              Conversions: <span class="blue-text">${monthlyConv.toLocaleString()}</span><br>
              Revenue: <span class="blue-text">${monthlyRev.toLocaleString()}€</span>
            </p>
          `;

          quarterlyHtml += `
            <p>
              <strong>${(ctr * 100).toFixed(1)}% CTR - ${label}</strong><br>
              Traffic: <span class="blue-text">${quarterlyTraffic.toLocaleString()}</span><br>
              Conversions: <span class="blue-text">${quarterlyConv.toLocaleString()}</span><br>
              Revenue: <span class="blue-text">${quarterlyRev.toLocaleString()}€</span>
            </p>
          `;
        });

        summaryOutput.innerHTML = `
          <h3>Summary (Monthly)</h3>
          Total Traffic: <span class="blue-text">${totalTraffic.toLocaleString()}</span><br>
          Total Conversions: <span class="blue-text">${totalConversions.toLocaleString()}</span><br>
          Total Revenue: <span class="blue-text">${totalRevenue.toLocaleString()}€</span>
        `;

        spinner.style.display = "none";
        monthlyOutput.style.display = "block";
        quarterlyOutput.style.display = "none";
        summaryOutput.style.display = "block";
        document.getElementById("revenueChart").style.display = "block";
        monthlyOutput.innerHTML = monthlyHtml;
        quarterlyOutput.innerHTML = quarterlyHtml;

        const ctx = document.getElementById('revenueChart').getContext('2d');
        if (window.revenueChart && typeof window.revenueChart.destroy === 'function') {
          window.revenueChart.destroy();
        }

        window.revenueChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Revenue (€)',
              data: revenues,
              backgroundColor: 'rgba(91, 134, 229, 0.6)',
              borderColor: 'rgba(91, 134, 229, 1)',
              borderWidth: 1,
              borderRadius: 6
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#25252a',
                titleColor: '#ffffff',
                bodyColor: '#ffffff',
                padding: 10,
                cornerRadius: 6
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: value => `${value.toLocaleString()}€`,
                  color: '#ffffff',
                  font: { size: 10 }
                },
                grid: { color: '#404045' }
              },
              x: {
                ticks: {
                  color: '#ffffff',
                  font: { size: 10 },
                  maxRotation: 45,
                  minRotation: 45
                },
                grid: { display: false }
              }
            }
          }
        });
      }, 300);
    }

    function exportToCSV() {
      const keyword = document.getElementById("keyword").value || "Unknown";
      const market = document.getElementById("market").value;
      const volume = document.getElementById("volume").value;
      const valueType = document.getElementById("valueType").value;
      const { cr, ngr, turnover } = data[market];
      const aov = valueType === 'ngr' ? ngr : turnover;

      let csv = `Keyword,Market,Search Volume,Value Type,CTR,Position,Monthly Traffic,Monthly Conversions,Monthly Revenue,Quarterly Traffic,Quarterly Conversions,Quarterly Revenue\n`;
      visibility.forEach(({ ctr, label }) => {
        const monthlyTraffic = Math.round(volume * ctr);
        const monthlyConv = Math.round(monthlyTraffic * cr);
        const monthlyRev = Math.round(monthlyConv * aov);

        const quarterlyTraffic = monthlyTraffic * 3;
        const quarterlyConv = monthlyConv * 3;
        const quarterlyRev = monthlyRev * 3;

        csv += `${keyword},${market},${volume},${valueType},${(ctr * 100).toFixed(1)}%,${label},${monthlyTraffic},${monthlyConv},${monthlyRev},${quarterlyTraffic},${quarterlyConv},${quarterlyRev}\n`;
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.setAttribute("href", URL.createObjectURL(blob));
      link.setAttribute("download", `seo_revenue_${keyword}_${market}.csv`);
      link.style.display = "none";
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Initialize flag on page load
    setFlag();
  </script>
</body>
</html>
